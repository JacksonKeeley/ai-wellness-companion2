<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        #timer {
            font-size: 48px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        #log {
            margin-top: 30px;
            text-align: left;
            display: inline-block;
            max-width: 300px;
        }
        #log h2 {
            text-align: center;
        }
        .log-entry {
            background-color: #f4f4f4;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>

    <h1>Study Timer</h1>
    <div id="timer">00:00</div>
    <div id="reminderMessage" style="font-size: 20px; color: #00cc18; margin: 15px 0;"></div>
    <button id="startButton">Start</button>
    <button id="stopButton" disabled>Stop</button>
    <button id="clearButton">End Timer</button>
    
    <div style="margin-top: 30px;">
        <strong>Current Role:</strong> <span id="currentRole">viewer</span><br>
        <button id="switchRoleButton">Switch Role</button>
        <button id="downloadButton" disabled>Download Logs</button>
    </div>

    <div id="log">
        <h2>Session Log</h2>
        <div id="logList"></div>
    </div>

    <script>
        let timer;
        let seconds = 0;
        let isRunning = false;

        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const clearButton = document.getElementById('clearButton');
        const timerDisplay = document.getElementById('timer');
        const logList = document.getElementById('logList');

        function formatTime(sec) {
            const minutes = Math.floor(sec / 60);
            const seconds = sec % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                const reminderDisplay = document.getElementById('reminderMessage');

                timer = setInterval(() => {
                    seconds++;
                    timerDisplay.textContent = formatTime(seconds);

                    if (seconds % 10 === 0) {
                        reminderDisplay.textContent = "ðŸ§  Reminder: Take a short break and breathe!";
                        // Clear the message after 3 seconds
                        setTimeout(() => {
                            if (!isRunning) return;
                            reminderDisplay.textContent = "";
                        }, 3000);
                    }
                }, 1000);
                startButton.disabled = true;
                stopButton.disabled = false;
            }
        }

        function stopTimer() {
        if (isRunning) {
            clearInterval(timer);
            isRunning = false;
            startButton.disabled = false;
            stopButton.disabled = true;
        }
    }

    function clearTimer() {
        // Log the session *before* resetting
        if (seconds > 0) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `Session: ${formatTime(seconds)}`;
            logList.appendChild(entry);
        }

        clearInterval(timer);
        isRunning = false;
        seconds = 0;
        timerDisplay.textContent = formatTime(seconds);
        startButton.disabled = false;
        stopButton.disabled = true;
    }

        startButton.addEventListener('click', startTimer);
        stopButton.addEventListener('click', stopTimer);
        clearButton.addEventListener('click', clearTimer);

        let currentRole = "viewer";
        const roleDisplay = document.getElementById("currentRole");
        const switchRoleButton = document.getElementById("switchRoleButton");
        const downloadButton = document.getElementById("downloadButton");

        switchRoleButton.addEventListener("click", () => {
            currentRole = currentRole === "admin" ? "viewer" : "admin";
            roleDisplay.textContent = currentRole;
            downloadButton.disabled = currentRole !== "admin";
        });

        downloadButton.addEventListener("click", () => {
            if (currentRole !== "admin") {
                alert("Access denied. Only admins can download logs.");
                return;
            }

            const logs = Array.from(document.querySelectorAll('.log-entry'))
                .map(entry => entry.textContent)
                .join('\n');

            const blob = new Blob([logs], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "study_sessions.txt";
            a.click();

            URL.revokeObjectURL(url);
        });

    </script>

</body>
</html>
